---
title: "DESeq2.Microbiome"
output: html_document
---

Normalization and group-wise comparisons with DESeq2
Examples adapted from [Callahan et al. F1000 (2017)]().

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = F, message = F)
# Load libraries
library(microbiome)
library(ggplot2)
```

```{r}
# Probiotics intervention example data 
data(dietswap) 

# Set baseline to 0 (in this data set it appears to be 1)
pseq <- microbiome::transform(dietswap, "shift", shift = -1)

# Only check the core taxa to speed up examples
pseq <- core(pseq, detection = 10^3, prevalence = 95/100)
```

```{r}
library(phyloseq)
library(reshape2)
library(DESeq2)

# Running the DESeq2 analysis
ds2 <- phyloseq_to_deseq2(pseq, ~ nationality)
dds <- DESeq(ds2)
res <- results(dds)
df <- as.data.frame(res)
df$taxon <- rownames(df)
df <- df %>% arrange(log2FoldChange, padj)

library(knitr)
print(head(kable((df))))
```

