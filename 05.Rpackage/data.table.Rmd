---
title: "Methods of dealing big data"
output:
  html_document: default
---

data manipulation in data.table R package is considered as the fastest package 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(data.table)
```

### load data 
```{r}
mydata <- fread("https://github.com/arunsrinivasan/satrdays-workshop/raw/master/flights_2014.csv")
```
### describe data
```{r}
dim(mydata)
names(mydata)
head(mydata)
```


### Selecting or Keeping Columns 
```{r}
dat1 <- mydata[ , origin] # returns a vector
dat2 <- mydata[ , .(origin)] # returns a data.table
dat1 <- mydata[, c("origin"), with=FALSE]
dat3 <- mydata[, .(origin, year, month, hour)]
dat4 = mydata[, c(2:4), with=FALSE]
```

### Dropping a Column
```{r}
dat5 = mydata[, !c("origin"), with=FALSE]
dat6 = mydata[, !c("origin", "year", "month"), with=FALSE]
```

### keeping variables that contain 'dep'
```{r}
dat7 = mydata[,names(mydata) %like% "dep", with=FALSE] # grep function
```

### Rename Variables
```{r}
setnames(mydata, c("dest","origin"), c("Destination", "origin.of.flight"))
names(mydata)
```

### Subsetting Rows / Filtering
```{r}
dat9 = mydata[origin %in% c("JFK", "LGA")]
dat10 = mydata[!origin %in% c("JFK", "LGA")]

setkey(mydata, origin)
data12 = mydata[c("JFK", "LGA")]

setkey(mydata, origin, dest)
mydata[.("JFK", "MIA")]
```

### Sorting Data 
```{r}
mydata01 = setorder(mydata, -origin)
mydata03 = setorder(mydata, origin, -carrier)
```

### Adding Columns (Calculation on rows)  ** := operator **
```{r}
mydata002 = mydata[, c("dep_sch","arr_sch"):=list(dep_time - dep_delay, arr_time - arr_delay)]
```

### IF THEN ELSE
```{r}
mydata[, flag:= 1*(min < 50)] # Method I :    
mydata[, flag:= ifelse(min < 50, 1,0)] # Method II :   
```

### Summarize or Aggregate Columns 
```{r}
mydata[, .(mean = mean(arr_delay, na.rm = TRUE),
    median = median(arr_delay, na.rm = TRUE),
    min = min(arr_delay, na.rm = TRUE),
    max = max(arr_delay, na.rm = TRUE))]

mydata[, lapply(.SD, mean), .SDcols = c("arr_delay", "dep_delay")]
mydata[, lapply(.SD, mean)]
mydata[, sapply(.SD, function(x) c(mean=mean(x), median=median(x)))]
```

### GROUP BY (Within Group Calculation)
```{r}
mydata[, .(mean(arr_delay, na.rm = TRUE), mean(dep_delay, na.rm = TRUE)), by = origin]
mydata[, lapply(.SD, mean, na.rm = TRUE), .SDcols = c("arr_delay", "dep_delay"), by = origin]
```

### Merging / Joins
```{r}
(dt1 <- data.table(A = letters[rep(1:3, 2)], X = 1:6, key = "A"))
(dt2 <- data.table(A = letters[rep(2:4, 2)], Y = 6:1, key = "A"))

merge(dt1, dt2, by="A")
merge(dt1, dt2, by="A", all.x = TRUE)
merge(dt1, dt2, by="A", all.y = TRUE)
merge(dt1, dt2, all=TRUE)
```

### Convert a data.table to data.frame
```{r}
setDF(mydata)
setDT(X, key = "A")
```

### Reshape Data
```{r}
dcast.data.table() 
melt.data.table() 
```


